<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Mini-Consulta IA Dr. Thiago</title>
  <style>
    :root {
      --bg-dark: #020617;
      --bg-card: #ffffff;
      --primary: #0f766e;
      --primary-soft: #ccfbf1;
      --accent: #22c55e;
      --text-main: #0f172a;
      --text-soft: #64748b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617 55%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 16px;
      color: var(--text-main);
    }

    .chat-wrapper {
      width: 100%;
      max-width: 480px;
    }

    .brand-header {
      text-align: center;
      color: #e5e7eb;
      margin-bottom: 10px;
    }

    .brand-header h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 600;
    }

    .brand-header p {
      margin: 4px 0 0;
      font-size: 13px;
      opacity: 0.8;
    }

    .chat-container {
      width: 100%;
      height: 80vh;
      max-height: 680px;
      background: var(--bg-card);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.55);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .chat-header {
      padding: 12px 16px;
      background: linear-gradient(90deg, #0f172a, #134e4a);
      color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #a7f3d0, #059669);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      color: #022c22;
      border: 2px solid rgba(15, 23, 42, 0.7);
    }

    .header-text-main {
      font-size: 14px;
      font-weight: 600;
    }

    .header-text-sub {
      font-size: 11px;
      opacity: 0.8;
    }

    .header-tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 4px 10px;
      background: rgba(15, 23, 42, 0.35);
      border: 1px solid rgba(148, 163, 184, 0.5);
      white-space: nowrap;
    }

    .chat-messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      background: #f3f4f6;
    }

    .message {
      max-width: 90%;
      margin-bottom: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .message.user {
      margin-left: auto;
      background: var(--primary);
      color: #ecfeff;
      border-bottom-right-radius: 0;
    }

    .message.bot {
      margin-right: auto;
      background: #ffffff;
      color: var(--text-main);
      border-bottom-left-radius: 0;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .chat-input-area {
      padding: 8px 10px;
      background: #f9fafb;
      border-top: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .input-row {
      display: flex;
      gap: 8px;
    }

    .chat-input-area input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background-color 0.15s;
    }

    .chat-input-area input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(45, 212, 191, 0.5);
      background: #ecfeff;
    }

    .chat-input-area button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #ecfeff;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: background 0.15s, transform 0.08s;
    }

    .chat-input-area button:hover:not(:disabled) {
      background: #115e59;
      transform: translateY(-1px);
    }

    .chat-input-area button:disabled {
      opacity: 0.6;
      cursor: default;
      transform: none;
    }

    .typing {
      font-size: 12px;
      color: var(--text-soft);
      padding: 0 4px;
      min-height: 16px;
    }

    .chat-footer {
      padding: 6px 10px 8px;
      border-top: 1px solid #e5e7eb;
      background: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .footer-text {
      font-size: 10px;
      color: var(--text-soft);
    }

    .footer-link {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: #0f766e;
      text-decoration: none;
      border: 1px solid rgba(34, 197, 94, 0.4);
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="chat-wrapper">
    <div class="brand-header">
      <h1>Mini-Consulta IA Dr. Thiago</h1>
      <p>Orienta√ß√£o educativa sobre h√©rnias, di√°stase e abd√¥men.</p>
    </div>

    <div class="chat-container">
      <div class="chat-header">
        <div class="header-left">
          <div class="avatar">T</div>
          <div>
            <div class="header-text-main">Dr. Thiago Silva</div>
            <div class="header-text-sub">Cirurgia de Parede Abdominal ‚Ä¢ T√©cnicas minimamente invasivas</div>
          </div>
        </div>
        <div class="header-tag">Conte√∫do educativo</div>
      </div>

      <div id="messages" class="chat-messages"></div>

      <div class="chat-input-area">
        <div id="typing" class="typing"></div>
        <div class="input-row">
          <input id="userInput" type="text" placeholder="Digite sua mensagem..." />
          <button id="sendBtn">Enviar</button>
        </div>
      </div>

      <div class="chat-footer">
        <div class="footer-text">
          N√£o substitui consulta presencial ou exame f√≠sico.
        </div>
        <a class="footer-link" href="https://wa.me/5581996313869" target="_blank">
          Agendar consulta
        </a>
      </div>
    </div>
  </div>

  <script>
    const systemPrompt = `
Mini Avalia√ß√£o IA Dr. Thiago ‚Äî Contexto Completo
Voc√™ √© a Mini-Consulta IA Dr. Thiago ‚Äî um agente digital criado para orientar pacientes sobre h√©rnias, di√°stase e altera√ß√µes da parede abdominal, conforme o M√©todo Dr. Thiago Silva.
Sua comunica√ß√£o √© emp√°tica, t√©cnica e leve, mantendo tom cordial, humano e profissional.
A miss√£o √© educar o paciente com explica√ß√µes claras e seguras, sem substituir a consulta m√©dica, diagn√≥stico ou indica√ß√£o cir√∫rgica definitiva.

ü©∫ In√≠cio fixo de todas as intera√ß√µes:
‚ÄúOl√°! Sou a Mini-Consulta IA Dr. Thiago, desenvolvida com o m√©todo do Dr. Thiago Silva para avalia√ß√£o de h√©rnias e di√°stase. Tudo bem com voc√™?
Para come√ßarmos, onde exatamente voc√™ sente o abaulamento, dor ou desconforto?‚Äù

Durante o di√°logo, a IA deve conduzir de forma natural e progressiva, fazendo apenas uma pergunta por vez, validando cada resposta com empatia breve:
‚ÄúEntendi, obrigado por compartilhar.‚Äù
‚ÄúTudo bem, isso j√° ajuda bastante.‚Äù
‚ÄúPode me contar com calma, sem pressa.‚Äù
‚ÄúPerfeito, vamos avan√ßar mais um pouquinho.‚Äù

A linguagem deve ser humana, direta e did√°tica, sem floreios nem diminutivos.

üîç Fluxo inteligente de triagem:
- Perguntar se o paciente j√° tem diagn√≥stico ou d√∫vida sobre sintomas.
- Coletar o nome.
- Local exato do abaulamento ou dor.
- Confirmar se piora com esfor√ßo.
- Perguntar se melhora ao deitar.
- Investigar cirurgias pr√©vias (tipo e tempo).
- Perguntar o sexo.
- Se mulher: perguntar sobre gesta√ß√µes.
- Perguntar sobre flacidez abdominal/excesso de pele.
- Perguntar peso e altura (sem calcular IMC).
- Investigar sintomas associados.
- Perguntar se possui exames de imagem.

üìå Se citar ‚Äúultrassom de abd√¥men total‚Äù, orientar:
‚ÄúEsse exame nem sempre mostra as h√©rnias corretamente. O ideal √© o ultrassom ou tomografia de parede abdominal.‚Äù

üìå Se n√£o tiver exame, orientar autoexame da di√°stase (exceto h√©rnia inguinal).

‚öñÔ∏è Regras de adapta√ß√£o:
- Se for h√©rnia inguinal, n√£o abordar di√°stase.
- Homem com h√©rnia inguinal: perguntar sobre cirurgia de pr√≥stata.

üß¨ Explica√ß√µes educativas:
- Excesso de pele grande ‚Üí abdominoplastia.
- Di√°stase sem excesso de pele ‚Üí corre√ß√£o rob√≥tica pode ser melhor.
- IMC > 30 ‚Üí preferir t√©cnicas rob√≥ticas (eTEP, p-eTEP, IPA).
- IMC < 28 e di√°stase leve/moderada ‚Üí Scolla ou MILA.
- Rob√≥tica oferece precis√£o e recupera√ß√£o mais r√°pida.
- V√≠deo √© alternativa em alguns casos.
- Aberta ‚Üí recupera√ß√£o mais lenta.

üöª Orienta√ß√µes por sexo:
Mulheres:
- Relacionar gesta√ß√µes, flacidez e di√°stase.
- Poss√≠vel associa√ß√£o com pl√°stica, lipo e retra√ß√£o de pele.

Homens:
- Di√°stase aumenta risco de h√©rnia.
- Rob√≥tica √© superior para reconstru√ß√£o.
- H√©rnias pequenas ‚Üí IPUM Plus pode ser op√ß√£o.

‚è±Ô∏è Recupera√ß√£o:
- Rob√≥tica: caminhar no mesmo dia; leve 5‚Äì7 dias; treinos em 3‚Äì4 semanas.
- V√≠deo: 10‚Äì14 dias; retorno 4‚Äì6 semanas.
- Aberta: repouso 4‚Äì6 semanas; retorno 6‚Äì8 semanas.

üßò Cuidados p√≥s-operat√≥rios:
- Cinta para conforto.
- Fisioterapia p√©lvica e abdominal.
- Alimenta√ß√£o rica em prote√≠nas.
- Evitar esfor√ßos nas primeiras semanas.

üìÖ Recomenda√ß√µes pr√°ticas:
- Dirigir: 3 dias.
- Trabalho leve: 7 dias.
- Atividade leve: 15 dias.
- Exerc√≠cios normais: 30 dias.

üßæ Resumo de recupera√ß√£o (quando perguntado):
‚ÄúAp√≥s a cirurgia, o foco √© uma recupera√ß√£o segura e progressiva...
3 dias para dirigir, 7 para trabalho leve, 15 para atividades leves e 30 para as normais ‚Äî sempre com libera√ß√£o m√©dica.‚Äù

‚öôÔ∏è T√©cnicas minimamente invasivas:
‚ÄúAs t√©cnicas minimamente invasivas, como v√≠deo e rob√≥tica, utilizam pequenas incis√µes e c√¢meras de alta precis√£o...‚Äù
‚ÄúA cirurgia rob√≥tica combina vis√£o 3D e precis√£o milim√©trica. O Dr. Thiago Silva √© refer√™ncia nacional em cirurgia rob√≥tica da parede abdominal.‚Äù

üìö Explica√ß√µes finais:
- H√©rnia inguinal: aberta, v√≠deo (TAPP/TEP) ou rob√≥tica.
- Outras h√©rnias/di√°stase: aberta, IPUM Plus, ventral TAPP, rob√≥ticas (eTEP, p-eTEP, IPA, TAR, r-TAR), Scolla, MILA.
- Rob√≥tica ‚Üí menos dor, recupera√ß√£o mais r√°pida, sem dreno.

‚ö†Ô∏è Sinais de alerta:
‚ÄúDor s√∫bita, abaulamento endurecido, febre, v√¥mito ou interrup√ß√£o de gases/fezes podem indicar complica√ß√£o. Procure atendimento.‚Äù

üí¨ Encerramento:
‚ÄúCom base nas suas respostas, essas s√£o as possibilidades mais comuns. A defini√ß√£o final depende da consulta presencial. Se desejar, agende aqui: https://wa.me/5581996313869‚Äù
‚ÄúEste m√©todo √© educativo e n√£o substitui consulta m√©dica especializada.‚Äù
Encerramentos alternativos:
‚ÄúFoi um prazer te orientar, [nome]. Cuide-se bem.‚Äù
‚ÄúFico feliz em ajudar, [nome]. Espero que tenha esclarecido tudo.‚Äù
‚ÄúObrigado pela conversa, [nome]. Boa recupera√ß√£o.‚Äù
`;

    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const typingEl = document.getElementById("typing");

    const chatHistory = [
      { role: "system", content: systemPrompt }
    ];

    function addMessage(text, sender = "bot") {
      const div = document.createElement("div");
      div.className = "message " + sender;
      div.textContent = text;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function callOpenAI(userMessage) {
      try {
        typingEl.textContent = "Mini-Consulta est√° digitando...";
        sendBtn.disabled = true;

        chatHistory.push({ role: "user", content: userMessage });

        const response = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages: chatHistory })
        });

        const data = await response.json();
        const botText = data.reply;

        chatHistory.push({ role: "assistant", content: botText });
        addMessage(botText, "bot");

      } catch (err) {
        addMessage("Erro ao conectar com a IA. Tente novamente.", "bot");
      } finally {
        typingEl.textContent = "";
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", () => {
      const text = inputEl.value.trim();
      if (!text) return;
      addMessage(text, "user");
      inputEl.value = "";
      callOpenAI(text);
    });

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendBtn.click();
    });

    addMessage(
      "Ol√°! Sou a Mini-Consulta IA Dr. Thiago, desenvolvida com o m√©todo do Dr. Thiago Silva para avalia√ß√£o de h√©rnias e di√°stase.\nTudo bem com voc√™?\nPara come√ßarmos, onde exatamente voc√™ sente o abaulamento, dor ou desconforto?",
      "bot"
    );
  </script>
</body>
</html>
